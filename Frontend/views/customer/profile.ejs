
<!doctype html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Add New Bike - Moto Dock</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
            <link rel="stylesheet" type="text/css" href="/assets/twn/frontend/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
        <link href="https://fonts.googleapis.com/css?family=Oswald|Titillium+Web" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/assets/twn/customer_dashboard/css/style.css">
        <link rel="stylesheet" type="text/css" href="/assets/twn/customer_dashboard/css/dashboard.css">
        <script type="text/javascript" src="/assets/twn/frontend/js/jquery-3.2.1.min.js"></script>
            <link rel="stylesheet" type="text/css" href="/assets/twn/parsley/parsley.css">
    <style>
        #block {
            display: none;
            width: 100%;
        }

        .selected {
            display: inherit !important;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="/assets/twn/css/bootstrap-datetimepicker.min.css">
    </head>
<body>
    <% include ../partials/loggedInMenu %> 

<div class="notificaitionDetail" id="notificationDetails">
</div>
<% include ../partials/sidebar.ejs %>  
<div class="col-lg-10 ritghPosData">
        <div class="dashData whiteSpaceData">
            <h5>My Profile</h5>
                                                            <div class="row userProfileBack">
                <div class="col-lg-3">
                    <div class="profileImage">
                        <img src="" alt="upload image" id="image"
                             width="200" height="200">
                    </div>
                </div>
                <div class="col-lg-9">

                    <form method="post" class="profileBtn">
                        <div class="row">

                            <div class="col-md-9">
                                <div class="profile-head">
                                    
                                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="home-tab" data-toggle="tab"
                                               href="#home" role="tab" aria-controls="home"
                                               aria-selected="true">Basic Info</a>
                                        </li>
                                        
                                        
                                        
                                        
                                        
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="updateButton float-right">
                                    <button type="button" class="btn" data-toggle="modal"
                                            data-target="#exampleModal">
                                        Update Profile
                                    </button>
                                </div>
                            </div>

                        </div>
                        <div class="row">

                            <div class="col-md-8">
                                <div class="tab-content profile-tab" id="myTabContent">
                                    <div class="tab-pane fade show active" id="home" role="tabpanel"
                                         aria-labelledby="home-tab">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Full Name</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p id="fullname"></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Email</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p id="email"></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Phone</label>
                                            </div>
                                            <div class="col-md-6">
                                                <p id="phone">
                                                    
                                                                                                                </p>
                                            </div>
                                        </div>

                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        
                        
                    </form>
                </div>

            </div>
        </div>
    </div>

            </div>
        </div>
    </div>
    <!-- Update Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Update Profile</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form method="POST"  accept-charset="UTF-8"
              id="profile-form"
              class="form-horizontal" role="form" enctype="multipart/form-data" data-parsley-validate="">
            <input type="hidden" name="_token" value="vhOWl4SOemgbbapeco5FZaCRhqFDRjPy2CKJDbkP">
            <div class="row">
                <div class="col-md-12">
                    <input type="text" class="form-control" id="efullname" name="first_name"
                           placeholder="Full Name" required 
                           data-parsley-pattern="^(?:[A-Za-z]+[ -])*[A-Za-z]+$"
                           data-parsley-length="[3, 30]"
                           data-parsley-trigger="keyup"/>

                    <input class="form-control"  name="email" type="email" id="eemail"
                          required data-parsley-trigger="keyup">

                    <input type="number" class="form-control" name="mobile" id="emobile" placeholder="Mobile"
                           id="emobile" data-parsley-maxlength="10"
                           data-parsley-pattern="/(9)[0-9]{9}/" required data-parsley-trigger="keyup">


                           <form  enctype="multipart/form-data" id="fileUploadForm">
                            <input class="form-control txt-field" type="file" name="fileToUpload" id="fileToUpload" />
                          </form> 

                </div>
            </div>

            <div class="updateButton float-right">
                 <button type="submit" id="update-profile" class="btn">
                    Save
                </button>
            </div>
        </form>
    </div>
    </div>
    </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
            integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="/assets/twn/js/smooth-scroll.js"></script>
    <script src="/assets/twn/js/scripts.js"></script>
    <script src="/assets/twn/js/logout.js"></script>

    <script>
    var x= localStorage.getItem('user');

let base_url = 'http://localhost:3000/';
$.ajax({
    type: 'GET',
    url: base_url + 'users/'+ x,
    success: function (user) {
       

            document.getElementById("image").src = base_url+'uploads/'+ user.image;
            document.getElementById("profile_image").src = base_url+'uploads/'+ user.image;
            document.getElementById("dashboard_image").src = base_url+'uploads/'+ user.image;
            document.getElementById("dash_name").innerHTML=user.fullName;


        document.getElementById("fullname").innerHTML = user.fullName;
        document.getElementById("email").innerHTML = user.email;
        document.getElementById("phone").innerHTML = user.mobileNumber;

        $("#efullname").val(user.fullName);
        $("#eemail").val(user.email);
        $("#emobile").val(user.mobileNumber);
        




    
    },
    error: function () {
        alert("Fill all the form fields!");
    }
});

$("#fileToUpload").on('change', function () {
    let formData = new FormData();
    let files = $("#fileToUpload").get(0).files;
    if (files.length > 0) {
        formData.append("imageFile", files[0]);
    }
    // $("#add-hero").prop("disabled", true);
    $.ajax({
        type: 'POST',
        url: base_url + 'upload',
        contentType: false,
        cache: false,
        processData: false,
        data: formData,
        success: function (data) {
            imageFile = data.filename;
            // $("#add-hero").prop("disabled", false);
        },
        error: function () {
            alert("Image upload failed!");
        }
    });
});

$("#update-profile").on('click', function () {
    let user = {
        fullName: $("#efullname").val(),
            mobileNumber: $("#emobile").val(),
            email: $("#eemail").val(),
            image: imageFile
    };
    $.ajax({
        type: 'PUT',
        url: base_url + 'users/'+ x,
        data: user,
        success: function (user) {
           location.reload();
        },
        error: function () {
            alert("Fill all the form fields!");
        }
    });
});






function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}
    </script>
  


</body>
</html>






